<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>dynv6使用技巧（如何添加多个地址 子域名 等） | 青羽~blog site</title>
  <meta name="description" content="# 前言 因为 ipv6 普及度日益增加，在自己的环境里搭建简易服务器的想法就逐渐发芽；无论是用于博客网站、NAS 或私有云的搭建，还是用来开游戏服务器，都能够简单易行地实现（因为有公网 ipv6）。 不过，很多时候家庭环境下 ipv6 地址也会发生变化，尤其是电脑重启、宽带重拨的时候，那么如何在没有固定 ipv6 的情况下让别人能更容易找到我们的地址呢？很简单，当然是用 DDNS 了。 DDNS">
<meta property="og:type" content="article">
<meta property="og:title" content="dynv6使用技巧（如何添加多个地址 子域名 等）">
<meta property="og:url" content="https://zjxdiu.github.io/blog/dynv6_notes/index.html">
<meta property="og:site_name" content="青羽~blog site">
<meta property="og:description" content="# 前言 因为 ipv6 普及度日益增加，在自己的环境里搭建简易服务器的想法就逐渐发芽；无论是用于博客网站、NAS 或私有云的搭建，还是用来开游戏服务器，都能够简单易行地实现（因为有公网 ipv6）。 不过，很多时候家庭环境下 ipv6 地址也会发生变化，尤其是电脑重启、宽带重拨的时候，那么如何在没有固定 ipv6 的情况下让别人能更容易找到我们的地址呢？很简单，当然是用 DDNS 了。 DDNS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zjxdiu.github.io/blog/_resources/8007661dd2ee4a33be77ca500ec41a76.png">
<meta property="article:published_time" content="2023-03-03T09:00:00.000Z">
<meta property="article:modified_time" content="2023-05-01T05:23:00.382Z">
<meta property="article:author" content="zjxdiu">
<meta property="article:tag" content="网络">
<meta property="article:tag" content="游戏">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zjxdiu.github.io/blog/_resources/8007661dd2ee4a33be77ca500ec41a76.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://zjxdiu.github.io/blog/dynv6_notes/index.html">
  
    <link rel="alternate" href="/atom.xml" title="青羽~blog site" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>


<body class="main-center theme-purple" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">时间线</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/zjxdiu" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎访问！站点正在建设，如需联系请查看建站文章</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%AA%E5%99%A8%E5%88%86%E6%9E%90/" rel="tag">仪器分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/" rel="tag">信号处理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%96%E5%AD%A6/" rel="tag">化学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8/" rel="tag">日常</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" rel="tag">游戏引擎</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A1%AC%E4%BB%B6/" rel="tag">硬件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%84%91%E6%B4%9E/" rel="tag">脑洞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B6%85%E9%A2%91/" rel="tag">超频</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">软件</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/%E4%BB%AA%E5%99%A8%E5%88%86%E6%9E%90/" style="font-size: 13px;">仪器分析</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/" style="font-size: 13px;">信号处理</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 13px;">分享</a> <a href="/tags/%E5%8C%96%E5%AD%A6/" style="font-size: 13px;">化学</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 13.33px;">开发</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 14px;">日常</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 13.67px;">游戏</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" style="font-size: 13px;">游戏引擎</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 13px;">生活</a> <a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 13px;">硬件</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 13.67px;">网络</a> <a href="/tags/%E8%84%91%E6%B4%9E/" style="font-size: 13px;">脑洞</a> <a href="/tags/%E8%B6%85%E9%A2%91/" style="font-size: 13px;">超频</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 13.33px;">软件</a>
    </div>
  </div>

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-blog/dynv6_notes" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      dynv6使用技巧（如何添加多个地址 子域名 等）
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/blog/dynv6_notes/" class="article-date">
	  <time datetime="2023-03-03T09:00:00.000Z" itemprop="datePublished">2023-03-03</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a>►<a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B/">网络工程</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a>, <a class="article-tag-link-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a>
  </span>


        

	<span class="article-read hidden-xs">
    	<i class="icon icon-eye-fill" aria-hidden="true"></i>
    	<span id="/blog/dynv6_notes/" class="leancloud_visitors"  data-flag-title="dynv6使用技巧（如何添加多个地址 子域名 等）">
			<span class="leancloud-visitors-count">0</span>
		</span>
    </span>

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/blog/dynv6_notes/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 1.6k(字)</span>
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>因为 ipv6 普及度日益增加，在自己的环境里搭建简易服务器的想法就逐渐发芽；无论是用于博客网站、NAS 或私有云的搭建，还是用来开游戏服务器，都能够简单易行地实现（因为有公网 ipv6）。<br>
不过，很多时候家庭环境下 ipv6 地址也会发生变化，尤其是电脑重启、宽带重拨的时候，那么如何在没有固定 ipv6 的情况下让别人能更容易找到我们的地址呢？很简单，当然是用 DDNS 了。<br>
DDNS，也就是动态 DNS，将一个变化的 IP 绑定到域名上，通过脚本定时检测和更新地址，这样即使地址变化，域名解析出来的地址也会跟着变化，仍然可以使用同一个域名定位到同一个地址。</p>
<h2 id="使用dynv6"><a class="markdownIt-Anchor" href="#使用dynv6">#</a> 使用 dynv6</h2>
<p>官网：<a target="_blank" rel="noopener" href="https://dynv6.com/">https://dynv6.com/</a><br>
 首先用邮箱注册一个账号，接着进入 My Zones，点击 Create New Zone，在 Name 里输入你想要的网址名称和后缀类型，下面的地址可以先点击 Set current address，这样网页就会填入你的外网 IP 地址（应注意检查，ipv4 基本不会是跟电脑一致，但 ipv6 需要一致）。<br>
<img src="../_resources/8007661dd2ee4a33be77ca500ec41a76.png" alt="8007661dd2ee4a33be77ca500ec41a76.png"></p>
<p>点击创建后，若网址没有冲突，则创建成功；直接点击这个域名，上面有两个选项是可以自己修改的：status 和 records。</p>
<h2 id="创建dns记录"><a class="markdownIt-Anchor" href="#创建dns记录">#</a> 创建 DNS 记录</h2>
<p>在 Status 里，点击 Edit Zone，将 ipv6 地址再次设为你的公网 ipv6 并保存，这样主域名就会直接解析到你的电脑上；<br>
在 Records 里，可以编辑或删除现有的 AAAA 记录，也可以新增其他 DNS 记录。</p>
<h3 id="创建子域名"><a class="markdownIt-Anchor" href="#创建子域名">#</a> 创建子域名</h3>
<p>点击 Add Record，选择 AAAA 类型（A 是 ipv4，AAAA 是 ipv6，CNAME 是网站别名一般用不到），前面的 name 里填写子域名前缀（<a target="_blank" rel="noopener" href="http://xn--web-th2ek25abiifsffvwu74d.domainname.dynv6.net">比如我要创建 web.domainname.dynv6.net</a>，那就在这里写 web），后面的地址里填写目标 ipv6 即可。</p>
<hr>
<h2 id="设置ddns自动更新"><a class="markdownIt-Anchor" href="#设置ddns自动更新">#</a> 设置 DDNS 自动更新</h2>
<p>提示：建议将此脚本部署于 Windows 服务器上，而非自己的电脑</p>
<h3 id="下载wget和grep"><a class="markdownIt-Anchor" href="#下载wget和grep">#</a> 下载 wget 和 grep</h3>
<p>网上很多教程，这里列两个：<br>
<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shenxiaolin/p/16662793.html">windows 下 grep 的安装与使用</a><br>
<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a8dfc762ba3b"> win10 安装 wget</a><br>
 记得检查好环境变量，确定 cmd 下运行这两个命令有输出。</p>
<h3 id="下载instsrvexe和srvanyexe"><a class="markdownIt-Anchor" href="#下载instsrvexe和srvanyexe">#</a> 下载 instsrv.exe 和 srvany.exe</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaiqianfeng/p/4622561.html">利用 instsrv 和 srvany 来手动安装服务</a></p>
<h3 id="编写脚本"><a class="markdownIt-Anchor" href="#编写脚本">#</a> 编写脚本</h3>
<ol>
<li>在特定路径下创建文件夹，将上述 instsrv.exe、srvany.exe 以及后续脚本均放在此处；</li>
<li>创建 install_server.bat 文件：</li>
</ol>
<pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off
<span class="hljs-built_in">set</span> curexe=%~dp0
<span class="hljs-built_in">cd</span> /d <span class="hljs-variable">%curexe%</span>
&quot;<span class="hljs-variable">%curexe%</span>instsrv.exe&quot; ddns_dynv6 &quot;<span class="hljs-variable">%curexe%</span>srvany.exe&quot;
@<span class="hljs-built_in">echo</span> ddns_dynv6 服务添加完成

@<span class="hljs-built_in">echo</span> 修改服务路径
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM 添加注册表语法: reg add 注册表路径 /v 项名称 /t 值类型 /d 数据 /f 表示强行修改不提示</span>
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM 名称 Application 值为你要作为服务运行的程序地址 /d对应的参数有斜杠不是为了转义引号，而是路径还有斜杠，默认将引号转义了，额外添加斜杠是为了保留引号</span>
 
<span class="hljs-built_in">set</span> regpath=HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ddns_dynv6\Parameters\
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM 名称 AppDirectory 值为你要作为服务运行的程序所在文件夹路径</span>
reg add <span class="hljs-variable">%regpath%</span> /v AppDirectory /t REG_SZ /d &quot;<span class="hljs-variable">%curexe%</span>\&quot; /f
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM 名称 AppParameters 值为你要作为服务运行的程序启动所需要的参数</span>
reg add <span class="hljs-variable">%regpath%</span> /v Application /t REG_SZ /d &quot;<span class="hljs-variable">%curexe%</span>dynv6.bat&quot; /f
 
<span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> ddns_dynv6
 
<span class="hljs-built_in">pause</span></code></pre>
<ol start="3">
<li>创建 remove_server.bat 文件：</li>
</ol>
<pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off
<span class="hljs-built_in">net</span> stop ddns_dynv6
instsrv ddns_dynv6 remove
<span class="hljs-built_in">pause</span></code></pre>
<ol start="4">
<li>创建 dynv6.bat 文件：</li>
</ol>
<pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off
@<span class="hljs-built_in">set</span> tempnum=
@<span class="hljs-built_in">set</span> ipaddr=
@<span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>
<span class="hljs-comment">rem domain=你注册的域名（dynv6.net 提供多种域名后缀可自行修改）</span>
@<span class="hljs-built_in">set</span> domain=【在这里填写你记录的域名，填zone名称】
<span class="hljs-comment">rem token=你注册后的钥匙（dynv6.net 提供）</span>
@<span class="hljs-built_in">set</span> token=【在这里填写你的token，把这段文字和括号删掉然后粘贴】
@<span class="hljs-built_in">set</span> IPV6_REGEX=&quot;\(\([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;:\)\&#123;<span class="hljs-number">1</span>,\&#125;\)\(\([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;\)\&#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>\&#125;\)\(\(:[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;\)\&#123;<span class="hljs-number">1</span>,\&#125;\)&quot;
@<span class="hljs-built_in">set</span> IPV4_REGEX=&quot;[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;&quot;
@<span class="hljs-built_in">set</span> URL=&quot;https://dynv6.com/api/update?hostname=<span class="hljs-variable">%domain%</span>&amp;token=<span class="hljs-variable">%token%</span>&amp;ipv4=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&quot;</span>
@<span class="hljs-built_in">set</span> URLV6=&quot;https://dynv6.com/api/update?hostname=<span class="hljs-variable">%domain%</span>&amp;token=<span class="hljs-variable">%token%</span>&amp;ipv6=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&amp;</span>ipv6prefix=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&quot;</span>
@<span class="hljs-built_in">set</span> BIN=wget -t <span class="hljs-number">2</span> --prefer-family=IPv6 --no-dns-cache --no-check-certificate
<span class="hljs-comment"> </span>
<span class="hljs-comment">rem ***ipv4***（dynv6也提供ipv4动态域名服务）</span>
<span class="hljs-comment">rem for /F %%i in (&#x27;nslookup %domain% ns1.dynv6.com ^|grep -m2 -o %IPV4_REGEX%&#x27;) do ( set oldipaddr=%%i)</span>
<span class="hljs-comment">rem ***ipv6***</span>
<span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;nslookup -qt^=AAAA <span class="hljs-variable">%domain%</span> ns1.dynv6.com ^|grep -m2 -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> ( <span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-variable">%%i</span>)
 
@<span class="hljs-built_in">echo</span> Current <span class="hljs-variable">%domain%</span> IP Add:<span class="hljs-variable">%oldipaddr%</span>
 
:start_ip1
<span class="hljs-comment">rem @cls</span>
@<span class="hljs-built_in">echo</span> ... 
@<span class="hljs-built_in">echo</span> <span class="hljs-number">1</span>.####从ip.sb获得地址####
@<span class="hljs-built_in">set</span> ip6addr=null
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM ***ipv6***</span>
<span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- http://ip.sb  ^|grep -m <span class="hljs-number">1</span> -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> ipaddr=<span class="hljs-variable">%%i</span>)
 
<span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%ipaddr%</span>&quot; == &quot;null&quot; (
<span class="hljs-built_in">echo</span> 没有IPV6地址或获得IPV6地址失败
timeout <span class="hljs-number">5</span>
<span class="hljs-keyword">goto</span> start_ip2
) <span class="hljs-keyword">else</span> (
<span class="hljs-built_in">echo</span> 获得IP地址:<span class="hljs-variable">%ipaddr%</span>，旧IP地址:<span class="hljs-variable">%oldipaddr%</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">NOT</span> &quot;<span class="hljs-variable">%oldipaddr%</span>&quot; == &quot;<span class="hljs-variable">%ipaddr%</span>&quot; (
<span class="hljs-built_in">echo</span> ---更新IP---
<span class="hljs-keyword">goto</span> update_web_ip
) <span class="hljs-keyword">else</span> (
<span class="hljs-built_in">echo</span> IP没有改变
timeout <span class="hljs-number">300</span>
<span class="hljs-built_in">cls</span>
<span class="hljs-keyword">goto</span> start_ip2
))
 
:start_ip2
@<span class="hljs-built_in">ipconfig</span> /flushdns
@<span class="hljs-built_in">echo</span> ...
<span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>.####从checkip.dyndns.com获得地址####
@<span class="hljs-built_in">set</span> ipaddr=null
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM ***ipv4***</span>
<span class="hljs-comment">rem for /F %%i in (&#x27;%BIN% -O- http://checkip.dyndns.com ^|grep -m 1 -o %IPV4_REGEX%&#x27;) do (set ipaddr=%%i)</span>
<span class="hljs-comment">REM ***ipv6***</span>
<span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- http://checkipv6.dyndns.com ^|grep -m <span class="hljs-number">1</span> -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> ipaddr=<span class="hljs-variable">%%i</span>)
 
<span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%ipaddr%</span>&quot; == &quot;null&quot; (
<span class="hljs-built_in">echo</span> 没有IP地址或获得IP地址失败
timeout <span class="hljs-number">5</span>
<span class="hljs-keyword">goto</span> start_ip1
) <span class="hljs-keyword">else</span> (
<span class="hljs-built_in">echo</span> 获得IP地址:<span class="hljs-variable">%ipaddr%</span>，旧IP地址:<span class="hljs-variable">%oldipaddr%</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">NOT</span> &quot;<span class="hljs-variable">%oldipaddr%</span>&quot; == &quot;<span class="hljs-variable">%ipaddr%</span>&quot; (
<span class="hljs-built_in">echo</span> ---更新IP---
<span class="hljs-keyword">goto</span> update_web_ip
) <span class="hljs-keyword">else</span> (
<span class="hljs-built_in">echo</span> IP没有改变
timeout <span class="hljs-number">300</span>
<span class="hljs-built_in">cls</span>
<span class="hljs-keyword">goto</span> start_ip2
))
 
 
:update_web_ip
@<span class="hljs-built_in">echo</span> ==============================================
@<span class="hljs-built_in">echo</span> ipaddr=&quot;<span class="hljs-variable">%ipaddr%</span>&quot;
@<span class="hljs-built_in">echo</span> ==============================================
@<span class="hljs-built_in">set</span> var=null
<span class="hljs-comment"> </span>
<span class="hljs-comment">REM ***ipv4***</span>
<span class="hljs-comment">rem for /F &quot;tokens=*&quot; %%i in (&#x27;%BIN% -O- %URL%&#x27;) do (set var=%%i)</span>
<span class="hljs-comment">REM ***ipv6***</span>
<span class="hljs-keyword">for</span> /F &quot;tokens=*&quot; <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- <span class="hljs-variable">%URLV6%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> var=<span class="hljs-variable">%%i</span>)
 
<span class="hljs-built_in">echo</span> 更新信息=<span class="hljs-variable">%var%</span>
<span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%var%</span>&quot; == &quot;addresses updated&quot; <span class="hljs-keyword">goto</span> end
<span class="hljs-built_in">echo</span> 更新失败
timeout <span class="hljs-number">120</span>
<span class="hljs-keyword">goto</span> start_ip2
 
:end
<span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-variable">%ipaddr%</span>
<span class="hljs-built_in">echo</span> 更新数据成功
timeout <span class="hljs-number">300</span>
<span class="hljs-keyword">goto</span> start_ip2
<span class="hljs-comment"></span>
<span class="hljs-comment">REM 以上每个TIMEOUT指令都表示等待一定时间（秒），可以按实际情况修改</span>
<span class="hljs-comment">REM 我这里的300秒应该是够用的，太短了占用过多资源，太长了更新不及时</span></code></pre>
<h2 id="开机自启动"><a class="markdownIt-Anchor" href="#开机自启动">#</a> 开机自启动</h2>
<p>创建一个计划任务即可，详情可百度教程</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://zjxdiu.github.io/blog/dynv6_notes/" title="dynv6使用技巧（如何添加多个地址 子域名 等）" target="_blank" rel="external">https://zjxdiu.github.io/blog/dynv6_notes/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/blog/%E9%9A%8F%E8%AE%B020230501/" title="Hexo批处理脚本更新，通过zerotier实现免费简易内网穿透"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/blog/Network_progress_CSUST/" title="长沙理工大学无线网络多设备共享解决方案"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/zjxdiu" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'ZkMCrUSQDneRSAnbRh5WaJry-gzGzoHsz',
    appKey: 'zUZV2LcazrzxOePqSCJPsWEK',
    placeholder: '头像将根据昵称自动生成哦~',
    avatar: 'identicon',
    meta: meta,
    pageSize: '10' || 10,
    visitor: true
  });
  </script>

     







</body>
</html>